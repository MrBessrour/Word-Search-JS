<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
      table td.highlighted {
        background-color: #999;
      }
      table td.found {
        background-color: rgb(255,0,0);
      }
      table td.normal {
        background-color: rgb(255, 255, 255);
      }
      table {
        cursor: pointer;
        border-spacing: 13px;
      }
      td {
        border: 1px solid black;
        width: 40px;
        height: 40px;
        font-size: 30px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <table id="grid"></table>
  </body>
  <script>
    var current_word = "";
    var dir = null;
    var prevCell = {
      x: null,
      y: null,
    };
    var currCell = {
      x: null,
      y: null,
    };
    var vector = null;
    var selection = [] ;

    var grid = [
      ["c", "b", "c", "A", "b", "c", "w", "x"],
      ["A", "a", "c", "A", "b", "c", "o", "x"],
      ["A", "b", "r", "A", "b", "c", "r", "x"],
      ["A", "b", "c", "f", "b", "c", "d", "x"],
      ["A", "b", "c", "l", "b", "c", "D", "x"],
      ["A", "b", "c", "e", "b", "c", "D", "x"],
      ["A", "b", "c", "s", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
    ];
    var words = ["car" , "self" , "word"]
    var found = [] ;

    function setup() {
      var html = "";
      for (var i = 0; i < 8; i++) {
        html += "<tr>";
        for (var j = 0; j < 8; j++) {
          html += "<td>" + grid[i][j] + "</td>";
        }
        html += "</tr>";
      }
      $("#grid").append(html);
    }

    function undoSelection() {
      $('#grid').find(".found").removeClass("normal").removeClass("highlighted") ;
      $("#grid")
        .find(".highlighted")
        .addClass("normal")
        .removeClass("highlighted");
     
      current_word = "";
      dir = null;
      selection = [] ;
      vector = null ;
    }
    
    function hTest(cCell, pCell) {
      if (cCell.y != pCell.y) return false;
      return true;
    }
    
    function vTest(cCell, pCell) {
      if (cCell.x != pCell.x) return false;
      return true;
    }
    
    function dTest(cCell, pCell) {
      if (Math.abs(cCell.x - pCell.x) != Math.abs(cCell.y - pCell.y))
        return false;

      vector = {
        x: cCell.x - pCell.x,
        y: cCell.y - pCell.y,
      };
      return vector;
    }

    function diagTest(cCell, pCell , vector) {
      if (Math.abs(cCell.x - pCell.x) != Math.abs(cCell.y - pCell.y))
        return false;
      
      if(cCell.x - pCell.x != vector.x){
        return false
      }

      if(cCell.y - pCell.y != vector.y){
        return false
      }

      return true;
    }
    function wordFound(){
      selection.forEach(index => {
        $("#grid tr").eq(index.y).find("td").eq(index.x).addClass("found").removeClass("normal") ;
      });
    }
    
    function checkWord(word){
      if(words.indexOf(word) > -1) {
        wordFound() ;
        found.push(word) ;
        wordFound() ;
        return true ;
      }
      return false ;
    }
    
    $(function () {
      var isMouseDown = false;
      $("#grid td")
        .mousedown(function () {
          isMouseDown = true;
          $(this).addClass("highlighted").removeClass("normal");

          prevCell.y = $(this).parent().index();
          prevCell.x = $(this).index();
          selection.push({x : prevCell.x , y : prevCell.y}) ;

          currCell.y = $(this).parent().index();
          currCell.x = $(this).index();

          current_word += $(this).text();

          return false; // prevent text selection
        })
        .mouseover(function () {
          if (isMouseDown) {
            if ($(this).attr("class") != "highlighted") {
              prevCell = { x: currCell.x, y: currCell.y };

              currCell.y = $(this).parent().index();
              currCell.x = $(this).index();
              selection.push({x : currCell.x , y : currCell.y}) ;


              if (dir == null) {
                if (hTest(currCell, prevCell)) dir = 1;
                if (vTest(currCell, prevCell)) dir = 0;
                vector = dTest(currCell, prevCell);
                if (vector != false) {
                  dir = 2;
                }
              }
              switch (dir) {
                case 0:
                  if (!vTest(currCell, prevCell)) {
                    undoSelection();
                  }
                  break;

                case 1:
                  if (!hTest(currCell, prevCell)) {
                    undoSelection();
                  }
                  break;
                case 2:
                  if (!diagTest(currCell, prevCell , vector)) {
                    undoSelection();
                  }
                  break;
                default:
                  break;
              }
              current_word += $(this).text();
              checkWord(current_word) ;
              console.log(current_word) ;

              // console.log(current_word) ;
            }

            $(this).addClass("highlighted").removeClass("normal");
          }
        });

      $(document).mouseup(function () {
        isMouseDown = false;
        undoSelection();
      });
    });

    setup();
  </script>
</html>
