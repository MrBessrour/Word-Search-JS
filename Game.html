<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
      table td.highlighted {
        background-color: #999;
      }
      table td.normal {
        background-color: rgb(255, 255, 255);
      }
      table {
        cursor: pointer;
        border-spacing: 13px;      
      }
      td {
        border: 1px solid black;
        width: 40px;
        height: 40px;
        font-size: 30px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <table id="grid"></table>
  </body>
  <script>
    var current_word = "";
    var dir = null;
    var prevCell = {
      x: null,
      y: null,
    };
    var currCell = {
      x: null,
      y: null,
    };

    var grid = [
      ["A", "b", "c", "A", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
      ["A", "b", "c", "A", "b", "c", "D", "x"],
    ];

    function setup() {
      var html = "";
      for (var i = 0; i < 8; i++) {
        html += "<tr>";
        for (var j = 0; j < 8; j++) {
          html += "<td>" + grid[i][j] + "</td>";
        }
        html += "</tr>";
      }
      $("#grid").append(html);
    }

    function undoSelection() {
      $("#grid")
        .find(".highlighted")
        .addClass("normal")
        .removeClass("highlighted");
      current_word = "";
      dir = null;
    }
    function hTest(cCell, pCell) {
      if (cCell.y != pCell.y) return false;
      return true;
    }
    function vTest(cCell, pCell) {
      if (cCell.x != pCell.x) return false;
      return true;
    }
    function dTest(cCell, pCell) {
      if (Math.abs(cCell.x - pCell.x) != Math.abs(cCell.y - pCell.y)) return false;
      return true;
    }

    $(function () {
      var isMouseDown = false;
      $("#grid td")
        .mousedown(function () {
          isMouseDown = true;
          $(this).addClass("highlighted").removeClass("normal");

          prevCell.y = $(this).parent().index();
          prevCell.x = $(this).index();

          currCell.y = $(this).parent().index();
          currCell.x = $(this).index();

          current_word += $(this).text();

          return false; // prevent text selection
        })
        .mouseover(function () {
          if (isMouseDown) {
            if ($(this).attr("class") != "highlighted") {
              prevCell = { x: currCell.x, y: currCell.y };

              currCell.y = $(this).parent().index();
              currCell.x = $(this).index();

              if (dir == null) {
                if (hTest(currCell, prevCell)) dir = 1;
                if (vTest(currCell, prevCell)) dir = 0;
                if (dTest(currCell, prevCell)) dir = 2;

                console.log(dir);
              }
              switch (dir) {
                case 0:
                  if (!vTest(currCell, prevCell)) {
                    undoSelection();
                  }
                  break;

                case 1:
                  if (!hTest(currCell, prevCell)) {
                    undoSelection();
                  }
                  break;
                case 2:
                  if (!dTest(currCell, prevCell)) {
                    undoSelection();
                  }
                  break;
              }
              current_word += $(this).text();
            }

            $(this).addClass("highlighted").removeClass("normal");
          }
        });

      $(document).mouseup(function () {
        isMouseDown = false;
        undoSelection();
      });
    });

    setup();
  </script>
</html>
